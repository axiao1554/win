"use strict";$(function(){var t,e,s=document.body,c=document.getElementById("process"),a=document.querySelectorAll(".img-ajax"),i=(document.getElementById("comments-count"),document.getElementById("gitcomment"),document.getElementById("article-toc")),n=null,o=!0;function d(){for(var t=$(".post-body").find("img"),e=0;e<t.length;e++)t[e].onclick=function(t){var t=t.srcElement.currentSrc,c=($(this),t=t,e=$("<div id='outerDiv'  style='position:fixed;top:0;left:0;background:rgba(0,0,0,0.7);z-index:100;width:100%;height:100%;display:none;'><div id='innerDiv' style='position:absolute;'><img  id='bigImg' src=''/></div></div>"),$("#outerDiv").remove(),$("body").append(e),"#outerDiv"),a="#innerDiv",d="#bigImg",e=t;$(d).attr("src",e),$("<img/>").attr("src",e).on("load",function(){var t,e,n=$(window).width(),o=$(window).height(),i=this.width,s=this.height,i=(o<s?n<(t=(e=o)/s*i)&&(e=(t=n)/i*s):e=n<i?(t=n)/i*s:(t=i,s),$(d).css("width",t),(n-t)/2),s=(o-e)/2;$(a).css({top:s,left:i}),$(c).fadeIn("fast")}),$(c).click(function(){$(this).fadeOut("fast")})}}function l(){return s.scrollTop||document.documentElement.scrollTop}1==/iphone|ios|android|ipod/i.test(navigator.userAgent.toLowerCase())&&"mobile"!=(t=location.search,e="from",(e=new RegExp("(?:&|/?)"+e+"=([^&$]+)").exec(t))?e[1]:"")&&(o=!1),setTimeout(function(){d()},1e3),$(".highlight").not(".gist .highlight").each(function(t,e){var n=$("<div>").addClass("highlight-wrap");$(e).after(n),n.append($("<button>").addClass("copy-btn").append("复制").on("click",function(t){var e=$(this).parent().find(".code").find(".line").map(function(t,e){return $(e).text()}).toArray().join("\n"),n=document.createElement("textarea"),o=window.pageYOffset||document.documentElement.scrollTop,o=(n.style.top=o+"px",n.style.position="absolute",n.style.opacity="0",n.readOnly=!0,n.value=e,document.body.appendChild(n),document.getSelection()),i=0<o.rangeCount&&o.getRangeAt(0);n.select(),n.setSelectionRange(0,e.length),n.readOnly=!1,document.execCommand("copy")?$(this).text("复制成功"):$(this).text("复制失败"),n.blur(),$(this).blur(),i&&(o.removeAllRanges(),o.addRange(i))})).on("mouseleave",function(t){var e=$(this).find(".copy-btn");setTimeout(function(){e.text("复制")},300)}).append(e)});function r(){c&&(c.style.width=l()/(s.scrollHeight-window.innerHeight)*100+"%");var n=a;if(n){var t=n.length;if(0<t)for(var o=l()+window.innerHeight,i=0;i<t;i++)!function(){var t,e=n[i];e.getBoundingClientRect().top+window.pageYOffset-document.documentElement.clientTop<=o&&e.getAttribute("data-src")&&0<e.getAttribute("data-src").length&&("img"===e.nodeName.toLowerCase()?(e.src=e.getAttribute("data-src"),e.style.display="block"):((t=new Image).onload=function(){e.innerHTML=""},t.src=e.getAttribute("data-src"),e.style.backgroundImage="url("+e.getAttribute("data-src")+")"),e.removeAttribute("data-src"))}()}}r();var u=$(document).scrollTop();function m(t){var e,n,o;i&&(e=i.offsetTop,n=i.offsetLeft,o=i.offsetWidth,l()<=e?i.style="":(i.style.position="fixed",i.style.top=t+"px",i.style.transition="top 0.5s",i.style.left=n+"px",i.style.width=o+"px"))}window.addEventListener("scroll",function(){var t;o&&((t=$(document).scrollTop())<u?t<=180?i&&(i.style=""):"block"!=$(".playlist").css("display")||$(".playlist").hasClass("mini")?m(80):m(140):180<=t&&m(80),u=$(document).scrollTop()),clearTimeout(n),n=setTimeout(function(){r()},200)})});